// Boilerplate content for required transition files
const OVERLAY_CSS_CONTENT = `
#frame { 
    margin: 0; 
    padding: 0; 
    overflow: hidden; 
    background-color: transparent; 
}
img { 
    display: block; 
    -webkit-user-select: none; 
}
`;

const POSITION_JSON_CONTENT = JSON.stringify({
    "x": 0,
    "y": 0,
    "width": 1280,
    "height": 720
}, null, 4);

// This ensures the transition name shows up correctly in Production Truck [cite: 415]
function generateOverlayHtml(schoolName, frameCount, cutDelaySec) {
    return `
<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="overlay.css">
    <script src="jqueryui.js"><\/script>
</head>
<body style="margin:0; padding:0; background:transparent;">
    <div id="frame" style="width:1280px; height:720px; position:relative;"></div>

    <script>
    var transitionName = "${schoolName} TRANSITION";
    var transitionAbbreviatedName = "${schoolName}"; // Shows in Production Truck [cite: 415]
    var transitionCutDelay = ${cutDelaySec};

    $(document).on("WjsReady", function(e) {
        var params = {
            name: transitionName,
            abbreviatedName: transitionAbbreviatedName,
            cutDelay: transitionCutDelay
        };
        bridge.transitionLoadedWithParams(JSON.stringify(params));
    });

    function play() {
        var $frame = $("#frame");
        var $images = [];
        // Loop through the rendered PNG sequence [cite: 245, 470]
        for(var j = 1; j <= ${frameCount}; j++) {
            $images[j-1] = $('<div style="position:absolute; z-index:' + j + '; display:none;"><img src="images/' + j + '.png" style="width:1280px;"></div>').appendTo($frame);
        }
        
        var i = 0;
        var myInterval = setInterval(function(){
            if (i > 0) $images[i-1].hide();
            if (i < ${frameCount}) {
                $images[i].show();
                i++;
            } else {
                clearInterval(myInterval);
                $frame.empty();
            }
        }, 33.33); // Runs at roughly 30fps
    }
    <\/script>
</body>
</html>`;
}
